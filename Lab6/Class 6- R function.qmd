---
title: "Class 6: R functions"
author: "Yi-Hung Lee (PID: A16587141)"
format: pdf
---
## Introduction of R Functions

Functions are how we get work sone in R. We call functions to do everything from data reading to do analysis and outputing plots and results. 

All function in R have at least three things:

- a **name** (you get to pick this)
- a input **arguments** (there can be only one ar loads - again you call)
- a **body** (where the work gets done, this codes between curly bracket)

## A first silly function

Lets write a function to add numbers. We can call it `add()`

```{r}
x <- 10
y <- 10
x + y
```

```{r}
add <- function(x, y=10){
  x + y
}
```

Can I just use the function?

```{r}
add(10)
```

## Create a gradebook
Write a function to grade student work.
### Example input vectors to start with

```{r}
student1 <- c(100, 100, 100, 100, 100, 100, 100, 90)
student2 <- c(100, NA, 90, 90, 90, 90, 97, 80)
student3 <- c(90, NA, NA, NA, NA, NA, NA, NA)
```

Calculate the average of the first student
```{r}
mean(student1)
```

Calculate student 2 average score by removing NA
```{r}
mean(student2, na.rm = TRUE)
mean(student3, na.rm = TRUE)
mean(na.omit(student2))
mean(na.omit(student3))
```

Drop the lowest grade by finding the min value for student1

```{r}
# Find the lowest score by index
min1 <- which.min(student1)

# Drop the lowest score
new_student1 <- student1[-c(min1)]

# Get the new mean
mean(new_student1)
```

Replace the NA with 0 for student2 and student3
```{r}
student2[is.na(student2)] <- 0
student2

student3[is.na(student3)] <- 0
student3
```

Drop the lowest grade by finding the min value for student2 and student3
```{r}
min2 <- which.min(student2)
new_student2 <- student2[-(min2)]
mean(new_student2)

min3 <- which.min(student3)
new_student3 <- student3[-(min3)]
mean(new_student3)
```

## Create a grade function

```{r}
student1 <- c(100, 100, 100, 100, 100, 100, 100, 90)
student2 <- c(100, NA, 90, 90, 90, 90, 97, 80)
student3 <- c(90, NA, NA, NA, NA, NA, NA, NA)
```

```{r}
grade <- function(x) {
  # Replace NA to 0
  x[is.na(x)] <- 0
  # Find the minimum score by index and remove it
  x <- x[-(which.min(x))]
  # Find the average
  mean(x)
}
```

```{r}
grade(student1)
grade(student2)
grade(student3)
```

## Use the grade function to grade the student HW

Read the student homework cvs file
```{r}
setwd("//Users/alex/Desktop/BIMM 143/Lab6")
student.hw <- read.csv("student_homework.csv", row.names = 1)
head(student.hw)

# or I can do 
# url <- "https://tinyurl.com/gradeinput"
# student.hw <- read.csv(url, row.names = 1)
```
> Q1: Write a function grade() to determine an overall grade from a vector of student homework
assignment scores dropping the lowest single score. If a student misses a homework (i.e. has an
NA value) this can be used as a score to be potentially dropped. Your final function should be
adquately explained with code comments and be able to work on an example class gradebook
such as this one in CSV format: “https://tinyurl.com/gradeinput” [3pts]

Grade function
```{r}
grade <- function(x) {
  # Replace NA to 0
  x[is.na(x)] <- 0
  # Find the minimum score by index and remove it
  x <- x[-(which.min(x))]
  # Find the average
  mean(x)
}
```

Apply the grade function to each row
The `apply()` function in R is super useful but  can be a little confusing to begin with.

```{r}
# Apply the grade() function into 2 to 6 index in each row
mean_score <- apply(student.hw, 1, grade)
mean_score
```

> Q2. Using your grade() function and the supplied gradebook, Who is the top scoring student
overall in the gradebook? [3pts]

```{r}
# Find the max average score student
which.max(mean_score)
```

> Q3. From your analysis of the gradebook, which homework was toughest on students (i.e. obtained
the lowest scores overall? [2pts]

```{r}
# Apply grade function into each HW
mean_hw <- apply(student.hw, 2, mean, na.rm = TRUE)
mean_hw

# Find the lowest HW
which.min(mean_hw)
```
> Q4. Optional Extension: From your analysis of the gradebook, which homework was most predictive of overall score (i.e. highest correlation with average grade score)? [1pt]

Create another gradebook that replaces NA with 0
```{r}
copy.student.hw <- student.hw
copy.student.hw[is.na(copy.student.hw)] <- 0
head(copy.student.hw)
```
Use `cor()` function to find the correlation between each HW and the mean score of the students
```{r}
corr <- apply(copy.student.hw, 2, cor, y = mean_score)
corr
```

```{r}
which.max(corr)
```